package com.tiempo.services;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.tiempo.persistence.entities.Registro;
import com.tiempo.persistence.repositories.RegistroRepository;
import com.tiempo.services.exceptions.RegistroException;
import com.tiempo.services.exceptions.RegistroNotFoundException;

@Service
public class RegistroService {
	
	@Autowired
	private RegistroRepository registrorepository;
	
	//Obtener todos los registros
	public List<Registro> findAll(){
		return this.registrorepository.findAll();
	}
	
	//Obtener por id
	public Registro findById(int idRegistro) {
		if(!this.registrorepository.existsById(idRegistro)){
			throw new RegistroNotFoundException("El registro no existe.");
		}
		return this.registrorepository.findById(idRegistro).get();
	}
	
	
	//Modificar un registro mediante su ID
	public Registro update(Registro registro, int idRegistro) {
		if(registro.getId() != idRegistro) {
			throw new RegistroException("El id del body y el id del path no coinciden");
		}
		if(!this.registrorepository.existsById(idRegistro)) {
			throw new RegistroNotFoundException("Esta tarea no existe");
		}
		if(registro.getFechaLectura() != null) {
			throw new RegistroException("No se puede modificar la fecha de lectura.");
		}
		if(registro.getPrecipitacion() != null) {
			throw new RegistroException("No se puede modificar el valor de la precipitaci√≥n.");
		}
		
		Registro registroBD = this.findById(idRegistro);
		registroBD.setUbicacion(registro.getUbicacion());
		registroBD.setTemperatura(registro.getTemperatura());
		registroBD.setUnidad(registro.getUnidad());
		
		return this.registrorepository.save(registroBD);
		
	}
	
	
	
	
	
	
	
	
	
	
}
